# Ahead of time compilation (AOT)

When you use the `PlatformBrowser` in your `bootstrap.ts` for running the application, all components' templates 
needs to be compiled in your users' browsers. 

This is not a good option for production use, since the compilation process consist of MAAAANY steps and needs to 
include the whole compiler package. Doing all this work every time someone loads your page is definitely a bad idea.
For these reasons it's better to have ahead of time compilation (AOT) where all the templates for your components are 
compiled beforehand eg. on your server. 

On the other hand, the JIT (Just in time compilation) way can be good for development.

## Installation

First you'll need to install some additional packages for compiling templates from command line and different platform.

```bash
$ npm install --save-dev @slicky/compiler-cli
$ npm install --save-prod @slicky/platform-server
```

## Configuration

Before starting you need to have your application configuration in independent file, just like it's described in 
[bootstrap](./bootstrap.md) doc.

Your `application.ts` file can't contain any side-affecting code or code which depends on browser (like using `document` 
or `window`). This is because we need to be able to run that script on server too.

Now you can update your `bootstrap.ts` file.

**bootstrap.ts:**

```typescript
import {PlatformServer} from '@slicky/platform-server';
import {APPLICATION} from './application';
import {APP_TEMPLATES_FACTORY} from '../aot/app-templates-factory';

const platform = new PlatformServer(APP_TEMPLATES_FACTORY);

platform.run(APPLICATION, document.getElementById('app'));
```

As you can see, we're including a new file `app-templates-factory.ts` which does not exists yet. This file will be 
generated by `@slicky/compiler-cli` from command line and contains all the components' templates.

To be able to compile your templates, you also need to update the `tsconfig.json` file and add following configuration:

```json
{
	"slickyCompilerOptions": {
		"applicationFile": "./app/application.ts",
		"outDir": "./aot"
	}
}
```

* `slickyCompilerOptions`: Options passed into slicky's compiler
	+ `applicationFile`: Path to your `application.ts` file which exports application in `APPLICATION`
	+ `outDir`: Path to directory where all the generated templates will be stored
	
Now you can run the command for generating templates, just provide path to `tsconfig.json` file:

```bash
$ node_modules/.bin/scc.js compile tsconfig.json
```

After running the command above, you'll find `app-templates-factory.ts` file in directory you wrote in 
`slickyCompilerOptions.outDir`.

You can finally rebuild your application (eg. with webpack) just like you would normally do.

## Gulp

CLI compiler can be easily used in gulp too. For now there is no specialized plugin, but we can still use it with 
anonymous function.

```typescript
import {Compiler} from '@slicky/compiler-cli';
import * as gulp from 'gulp';

gulp.task(`compile:aot`, (done) => {
	(new Compiler).compileAndWrite('tsconfig.json', () => {
		done();
	});
});
```

And run it:

```bash
$ gulp compile:aot
```
